<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DjuntaCar - Accueil</title>
    
    <link rel="stylesheet" href="style.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-[#fcfcfd] antialiased">

    <header>
        <div class="header-left"><button onclick="toggleMenu()"><i data-lucide="menu" class="w-7 h-7 text-[#1d4379]"></i></button></div>
        <div class="header-center"><img src="logo.png" alt="DjuntaCar" class="header-logo"></div>
        <div class="header-right"><button onclick="window.location.href='profile.html'"><i data-lucide="user" class="w-7 h-7 text-[#1d4379]"></i></button></div>
    </header>

    <section class="hero-section">
        <div class="nav-container">
            <div onclick="window.location.href='search-car.html'" class="search-bar-link">
                <div class="search-icon"><i data-lucide="search" class="w-4 h-4"></i></div>
                <div class="search-text">Trouver la voiture parfaite</div>
            </div>
        </div>
    </section>

    <div class="filter-wrapper">
        <div class="filter-grid">
            <button onclick="filterCars('all', this)" class="filter-btn active"><i data-lucide="layout-grid"></i> Tous</button>
            <button onclick="filterCars('4x4', this)" class="filter-btn"><i data-lucide="mountain"></i> 4x4</button>
            <button onclick="filterCars('citadine', this)" class="filter-btn"><i data-lucide="car"></i> Citas</button>
            <button onclick="filterCars('luxe', this)" class="filter-btn"><i data-lucide="gem"></i> Luxe</button>
        </div>
    </div>

    <main class="content-padding vertical-list" id="cars-container">
        <div class="text-center py-10">
            <i data-lucide="loader" class="animate-spin w-8 h-8 text-[#1d4379] mx-auto mb-2"></i>
            <p class="text-xs font-bold text-gray-400">Chargement des v√©hicules...</p>
        </div>
    </main>

    <div class="fixed-footer">
        <button onclick="window.location.href='add-car.html'" class="btn-action btn-primary">Ajouter ma voiture</button>
        <button onclick="window.location.href='driver-application.html'" class="btn-action btn-success">Devenir chauffeur</button>
    </div>

    <div id="menu-overlay" onclick="toggleMenu()"></div>
    <div id="universal-menu">
        <div class="menu-header">
            <img src="logo.png" style="height: 32px;">
            <button onclick="toggleMenu()"><i data-lucide="x" style="width: 24px; color: #1d4379;"></i></button>
        </div>
        <nav class="menu-nav">
            <a href="index.html" class="menu-link"><i data-lucide="home"></i> Accueil</a>
            <a href="search-car.html" class="menu-link"><i data-lucide="search"></i> Recherche</a>
            <a href="my-rentals.html" class="menu-link"><i data-lucide="calendar"></i> Mes Locations</a>
            <a href="profile.html" class="menu-link"><i data-lucide="user"></i> Profil</a>
        </nav>
        <div class="menu-footer">
            <button onclick="if(confirm('D√©connexion ?')) window.location.href='login.html'" class="btn-logout"><i data-lucide="log-out"></i> D√©connexion</button>
        </div>
    </div>

    <script>
        lucide.createIcons();
        function toggleMenu() { document.getElementById('universal-menu').classList.toggle('open'); document.getElementById('menu-overlay').classList.toggle('open'); }
        
        // ---------------------------------------------------------
        // üëá COLLEZ VOS CL√âS ICI (Entre les guillemets '...') üëá
        // ---------------------------------------------------------
        const SUPABASE_URL = 'VOTRE_URL_SUPABASE_ICI'; 
        const SUPABASE_KEY = 'VOTRE_CLE_ANON_ICI';
        // ---------------------------------------------------------

        let allCars = [];

        async function init() {
            try {
                // Connexion (Exactement comme le test r√©ussi)
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                // R√©cup√©ration des donn√©es
                const { data, error } = await supabase.from('cars').select('*');
                
                if (error) throw error;

                // Succ√®s : On affiche
                allCars = data;
                renderCars(allCars);

            } catch (err) {
                console.error("Erreur:", err);
                document.getElementById('cars-container').innerHTML = `
                    <div class="text-center py-10">
                        <p class="text-red-500 font-bold text-xs">Erreur de chargement.</p>
                        <p class="text-gray-400 text-[10px] mt-1">V√©rifiez vos cl√©s dans le code.</p>
                    </div>`;
            }
        }

        function renderCars(cars) {
            const container = document.getElementById('cars-container');
            
            if (cars.length === 0) {
                container.innerHTML = '<div class="text-center py-10 text-gray-400 text-xs font-bold">Aucune voiture trouv√©e.</div>';
                return;
            }

            container.innerHTML = cars.map(car => `
                <div class="car-card" onclick="window.location.href='car-detail.html?id=${car.id}'">
                    <div class="card-image-box">
                        <div class="badge-container">
                            <span class="badge verified">V√©rifi√©</span>
                        </div>
                        <img src="${car.image_url}" onerror="this.src='https://via.placeholder.com/400x300?text=Auto'">
                        <div class="location-pill"><i data-lucide="map-pin" class="w-3 h-3"></i> ${car.location || 'Cap Vert'}</div>
                    </div>
                    <div class="card-details">
                        <div class="card-title-row">
                            <h3 class="card-title">${car.brand} ${car.model}</h3>
                            <div class="rating"><i data-lucide="star" class="w-3 h-3 fill-amber-500"></i> 5.0</div>
                        </div>
                        <div class="card-footer-row">
                            <span class="btn-text">D√©tails</span>
                            <p class="price-display">${car.price_per_day} <span class="price-suffix">CVE</span></p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            lucide.createIcons(); // Rafra√Æchir les ic√¥nes
        }

        // Filtre simple
        function filterCars(cat, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            if (cat === 'all') renderCars(allCars);
            else renderCars(allCars.filter(c => c.category && c.category.toLowerCase().includes(cat)));
        }

        // Lancement
        init();
    </script>
</body>
</html>
