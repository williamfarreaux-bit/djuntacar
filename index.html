<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DjuntaCar - MobilitÃ© Cap-Vert</title>
    <style>
        :root {
            --blue-atlantique: #1A4384;
            --green-kaminhu: #76B852;
            --bg-gray: #f4f7f6;
            --white: #ffffff;
            --radius: 12px; /* [cite: 10] */
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg-gray);
            margin: 0; padding: 0; color: #333;
        }

        /* --- UI GÃ‰NÃ‰RALE --- */
        .card { background: var(--white); border-radius: var(--radius); padding: 15px; margin-bottom: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .btn-primary { background: var(--blue-atlantique); color: white; border: none; padding: 15px; border-radius: var(--radius); font-weight: bold; width: 100%; cursor: pointer; }
        .btn-success { background: var(--green-kaminhu); color: white; border: none; padding: 15px; border-radius: var(--radius); font-weight: bold; width: 100%; cursor: pointer; }

        /* --- Ã‰CRAN 1 : ACCUEIL [cite: 12] --- */
        header { 
            background: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd;
        }
        .logo { font-weight: bold; color: var(--blue-atlantique); display: flex; align-items: center; gap: 5px; }
        .hero { padding: 30px 20px; text-align: left; }
        .hero h1 { color: var(--blue-atlantique); font-size: 24px; margin-bottom: 20px; } /* [cite: 18] */
        
        .search-bar { background: white; padding: 12px; border-radius: var(--radius); display: flex; align-items: center; border: 1px solid #ddd; }
        .search-bar input { border: none; width: 100%; outline: none; font-size: 16px; }

        .filters { display: flex; gap: 10px; padding: 0 20px 20px; overflow-x: auto; } /* [cite: 21] */
        .filter-item { padding: 10px 15px; background: white; border-radius: 20px; white-space: nowrap; border: 1px solid #ddd; font-size: 14px; }

        /* --- LISTE VÃ‰HICULES [cite: 25] --- */
        #car-list { padding: 0 20px; }
        .car-image { width: 100%; height: 180px; object-fit: cover; border-radius: var(--radius); margin-bottom: 10px; }
        .price-toggle { font-size: 12px; color: var(--blue-atlantique); cursor: pointer; font-weight: bold; }

        /* --- NAVIGATION --- */
        .screen { display: none; }
        .screen.active { display: block; }

        nav.bottom-nav { 
            position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 15px 0; border-top: 1px solid #ddd;
        }
    </style>
</head>
<body>

<header>
    <div class="logo">ğŸ¤ DjuntaCar</div>
    <div class="lang">ğŸ‡¨ğŸ‡» â–¼</div> </header>

<div id="screen-home" class="screen active">
    <div class="hero">
        <h1>Onde Ã© que queres ir?</h1> <div class="search-bar">
            ğŸ” <input type="text" placeholder="Choisir une Ã®le (Santiago, Sal...)" id="search-input">
        </div>
    </div>

    <div class="filters">
        <div class="filter-item">ğŸš™ 4x4 & Aventura</div>
        <div class="filter-item">ğŸš— Citadinas</div>
        <div class="filter-item">ğŸ’ Premium</div>
    </div>

    <div id="car-list">
        <div style="text-align:center; padding:50px;">Chargement du parc automobile...</div>
    </div>
    
    <div style="height: 80px;"></div> </div>

<div id="screen-detail" class="screen">
    <button onclick="showScreen('screen-home')" style="margin: 20px; border:none; background:none; font-size:18px;">â¬… Retour</button>
    <div id="detail-content" style="padding: 20px;"></div>
    <div style="height: 100px;"></div>
    <div style="position: fixed; bottom: 20px; width: 100%; padding: 0 20px; box-sizing: border-box;">
        <button class="btn-primary">Reservar agora</button> </div>
</div>

<nav class="bottom-nav">
    <span>ğŸ </span>
    <span>ğŸ“…</span>
    <span>ğŸ‘¤</span>
</nav>

<script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const SUPABASE_URL = 'https://enuiuuwnjzvpfvpklmjw.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_MDe_Df6NgeA-MmeP1pguPQ_tgF2k8s-';
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    let useEUR = false;

    // Fonction de conversion 
    const formatPrice = (cve) => {
        if (useEUR) return (cve / 110.265).toFixed(2) + ' EUR';
        return cve.toLocaleString() + ' CVE';
    };

    window.showScreen = (id) => {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    };

    async function loadApp() {
        const { data: vehicles, error } = await supabase.from('vehicles').select('*');
        const list = document.getElementById('car-list');

        if (error) {
            list.innerHTML = "Erreur de connexion base de donnÃ©es.";
            return;
        }

        list.innerHTML = `<p class="price-toggle" onclick="toggleCurrency()">ğŸ”„ Convertir en EUR/USD</p>`;

        vehicles.forEach(car => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <img src="${car.image_url || 'https://via.placeholder.com/400x200?text=DjuntaCar'}" class="car-image">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h3 style="margin:0; color:#1A4384;">${car.name}</h3>
                    <span style="font-weight:bold;">${formatPrice(car.price_per_day)}</span>
                </div>
                <p style="font-size:12px; color:gray; margin: 5px 0;">â›½ ${car.type} | ğŸ•¹ï¸ ${car.transmission}</p>
                <button class="btn-primary" style="margin-top:10px; padding:10px;" onclick="viewCar('${car.id}')">Voir dÃ©tails</button>
            `;
            list.appendChild(card);
        });
    }

    window.toggleCurrency = () => {
        useEUR = !useEUR;
        loadApp();
    };

    window.viewCar = async (id) => {
        const { data: car } = await supabase.from('vehicles').select('*').eq('id', id).single();
        const content = document.getElementById('detail-content');
        content.innerHTML = `
            <img src="${car.image_url || 'https://via.placeholder.com/400x200'}" style="width:100%; border-radius:12px;">
            <h2 style="color:#1A4384; margin-top:20px;">${car.name}</h2>
            <div class="card" style="display:flex; align-items:center; gap:15px;">
                <div style="width:50px; height:50px; background:#ddd; border-radius:50%;"></div>
                <div><strong>PropriÃ©taire : Manuel</strong><br><span style="color:var(--green-kaminhu);">â­ 4.9 Â· VÃ©rifiÃ©</span></div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:20px;">
                <div class="card">ğŸ•¹ï¸ ${car.transmission}</div>
                <div class="card">â„ï¸ Clim AC</div>
            </div>
        `;
        showScreen('screen-detail');
    };

    loadApp();
</script>
</body>
</html>
