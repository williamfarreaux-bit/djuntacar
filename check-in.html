<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Check-in - DjuntaCar</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * { font-family: 'Montserrat', sans-serif !important; }
        .photo-slot { border: 2px dashed #e2e8f0; border-radius: 20px; height: 120px; display: flex; flex-direction: column; items-center; justify-content: center; gap: 8px; color: #94a3b8; font-size: 10px; font-weight: 700; text-transform: uppercase; }
    </style>
</head>
<body class="bg-[#fcfcfd] p-6">

    <header class="flex justify-between items-center mb-8">
        <h1 class="text-xl font-black text-[#1d4379]">ÉTAT DES LIEUX DÉPART</h1>
        <div class="text-[10px] bg-green-100 text-green-600 px-3 py-1 rounded-full font-black uppercase">Phase 1/2</div>
    </header>

    <div class="bg-white p-6 rounded-[2.5rem] shadow-sm border border-gray-100 mb-8">
        <h2 class="text-xs font-black text-gray-400 uppercase mb-6 tracking-widest">Photos obligatoires</h2>
        <div class="grid grid-cols-2 gap-4">
            <div class="photo-slot"><i data-lucide="camera"></i>Avant</div>
            <div class="photo-slot"><i data-lucide="camera"></i>Arrière</div>
            <div class="photo-slot"><i data-lucide="camera"></i>Côté Gauche</div>
            <div class="photo-slot"><i data-lucide="camera"></i>Côté Droit</div>
            <div class="photo-slot col-span-2"><i data-lucide="gauge"></i>Tableau de bord (Carburant/KM)</div>
        </div>
    </div>

    <div class="bg-blue-50 p-6 rounded-[2rem] border border-blue-100 mb-8">
        <div class="flex items-start gap-4">
            <i data-lucide="info" class="text-[#1d4379] w-6 h-6"></i>
            <p class="text-[11px] text-blue-900 font-bold leading-relaxed">
                En validant le Check-in, le contrat est officiellement signé et la rémunération du propriétaire est débloquée.
            </p>
        </div>
    </div>

    <button onclick="confirmCheckIn()" class="w-full bg-[#1d4379] text-white py-5 rounded-[22px] font-black shadow-xl flex items-center justify-center gap-3">
        DÉMARRER LA LOCATION
        <i data-lucide="play" class="w-5 h-5"></i>
    </button>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        lucide.createIcons();
        const supabase = window.supabase.createClient('URL', 'KEY');

        async function confirmCheckIn() {
            const bookingId = new URLSearchParams(window.location.search).get('id');
            
            // 1. Mise à jour du statut
            const { error } = await supabase.from('bookings').update({ status: 'in_progress' }).eq('id', bookingId);
            
            if (!error) {
                // 2. LOGIQUE BACK-END (Appel automatique)
                // On déclenche le virement propriétaire (75% du prix car)
                await supabase.functions.invoke('process-payout', {
                    body: { bookingId: bookingId, type: 'START_RENTAL' }
                });
                
                alert("Check-in validé ! La location commence et le propriétaire a été payé.");
                window.location.href = 'my-rentals.html';
            }
        }
    </script>
</body>
</html>
